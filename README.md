# hs-to-lean

This is a project by Tally Holcombe for her Masters in Electrical Engineering and Computer Science Thesis at Chapman University.

The goal of this project is to verify Haskell code by translating it into Lean (Theorem Prover) code. 

**Currently Under Construction** This repo is still under construction. Unnecessary or pedantic information will be removed once this project is finalized.

## Description

The overarching goal of this project is to successfully validate Haskell s ource code by translating it into the [Lean Theorem Prover](https://lean-lang.org/). 

It is inspired by the work of Antal Spector-Zabusky, Joachim Breitner, Christine Rizkallah, and Stephanie Weirich in their paper [Total Haskell is Reasonable Coq](https://arxiv.org/abs/1711.09286). Their compiler can also be found [here](https://github.com/plclub/hs-to-coq).

## Dependencies

This project requires the following packages: 
* ghc 9.4.8
* ghc-lib-parser
* syb
* filepath

## Compilation

In the parent directory (hs-to-lean), run the program 
```
cabal build
cabal run hs-to-lean > "output.txt"
```

or

```
cabal build
cabal run hs-to-lean <filepath> > "output.txt"
```

The Lean translation is written to a file called `LeanResult.lean` in the parent folder (hs-to-lean). 

`> "output.txt"` writes any output to an output file (will delete later).

Running without a filepath will translate the default Haskell program (examples/TestFunctions.hs). 

To translate other Haskell files, put the target haskell file into the examples director. (Note: make sure it has the module header: `module ModuleName where`).

All translated files should be in the `examples` directory. All filepaths entered during compilation should be of the format `examples/...`

## Notable Limitations

* There are plenty small limitations. Bigger limitations will be added to this list as they are discovered.

## Current File Set-Up

### Files created at compilation

This project is still under testing and development. At this time, multiple files are created at runtime in order to test, verify, and/or visualize the translation process. 

The current files created/updated during run time are:
* **output.txt:** This file contains the the result of translating the ghc-lib-parser's AST back into Haskell code. 
    * It is used as a reference point for translating. It is much easier to translate Haskell *back* into Haskell. Thus, this file is a useful aid during the transposal from Haskell to Lean
* **AST.txt:** The raw AST generated by ghc-lib-parser
    * a good reference point for understanding how ghc-lib-parser's AST is structured. Also, a necessary file in order to generate a structured AST file for better visualization
* **hs_structured_AST.txt:** The structured AST, derivied from the raw AST (from src/AST.txt), indented to provide structure and readability
    * created by src/StructureAst.hs file
* **IntermediateAST.txt:** The (custom) intermediate AST generated from parsing the ghc-lib-parser's AST.
    * Presents/writes the intermediate AST for the given Haskell program as a "list" of AST objects. 
    * Currently useful for visualization and debugging during the development of the AST ADT. The "list" is also used to expedite translation between the intermediate AST to Lean code


### Current Translation Files
* **app/Main.hs:** The main module to execute everything
    * Currently hard-coded to translate the src/TestAST.hs file
        * still cannot figure out how to enter filename in Command Line
* **src/HsToLean/ProcessFile:** Given ghc-lib-parser's `ParsedSource` object, this module transforms the ghc-lib-parser's AST into the custom-built intermediate AST used for this project. 
    * At present, it writes the translation to a .txt file (IntermediateAST.txt), but will eventually return the AST directly for translation to Lean
* **src/TestAST.hs:** This module contains the AST ADT and functions for translating from the AST ADT to Lean code. 
    * The code for the AST ADT will be separated from the translation functions
    * Not yet integrated with app/Main.hs. In order to see translations from the AST ADT to Lean, you must run/compile the code in the terminal (`runhaskell src/TestAST.hs`)
* **src/HsToLean/SimpleAST.hs:** This is a reference file that will be deleted during the finalization of this project.
    * It was the initial file used during the brainstorming and tinkering process for developing the intermediate AST.
    * Will be deleted.
* **src/HsToLean/TranslateHaskell.hs:** Initial attempts to translate Haskell code into Lean
    * Not currently in use, but still provides a good reference for differences between Haskell and Lean syntax. 
    * Will be deleted.
* **src/HaskellToHaskell.hs:** Translate Haskell into Haskell
    * An exercise in understanding/using the ghc-lib-parser ast
    * excellent reference for what ghc-lib-parser's constructors do in relation to parts of Haskell code
    * WIll be deleted.
* **src/TestAST.hs:** The file the contains the test functions
    * used to test the translation from Haskell to Lean
    * functions implement an assortment of actions in all different combinations to ensure a robust translation.


